@using Project.Web.Common
@{
    SessionHelper session = new  SessionHelper();   
    ViewBag.Title = "Admin Setting";
    int flag =  0;
}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<title>Virtual Pacs</title>
<!-- Bootstrap -->
<link href="@Url.Content("~/Content/css1/bootstrap.min.css")" rel="stylesheet">
<link href="@Url.Content("~/Content/css1/animate.css")" rel="stylesheet">
<link href="@Url.Content("~/Content/css1/font-awesome.min.css")" rel="stylesheet">
<!-- REVOLUTION BANNER CSS SETTINGS -->
<link href="@Url.Content("~/Content/css1/custom.css")" rel="stylesheet">
<link href="@Url.Content("~/Content/css1/responisve.css")" rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/Content/js/modernizr-custom.js")"></script>
 <script src="@Url.Content("~/Scripts/js/jQuery-2.1.4.min.js")"></script>
<script src="@Url.Content("~/Content/js/custom.js")"></script>

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body class="add_load">
<input type="hidden" id="txtorgid" />
<main class="animsition"> 
  <!--Header sec start-->
  <header class="header">
    <nav class="navbar navbar-default navbar-fixed-top affix-top" id="mainNav">
      <div class="container"> 
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" class="navbar-toggle collapsed" type="button"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button>
          <a href="" class="navbar-brand page-scroll"><img src="@Url.Content("~/Content/img/logo.png")"></a> </div>
        
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div id="bs-example-navbar-collapse-1" class="collapse navbar-collapse">
          <ul class="nav navbar-nav navbar-right">
            <li> <a href="@Url.Action("Index", "Home")" class="page-scroll">Studies</a> </li>
            @*<li> <a href="" class="page-scroll">Activities<span>11</span></a> </li>
            <li> <a href="" class="page-scroll">Patients</a> </li>
            <li> <a href="" class="page-scroll">Analytics</a> </li>
            <li> <a href="" class="page-scroll">Cases</a> </li>
            <li> <a href="" class="page-scroll">Messages</a> </li>*@
            <li> <a href="#" class="page-scroll">Administration</a> </li>
          </ul>
        </div>
        <!-- /.navbar-collapse --> 
      </div>
      <!-- /.container-fluid -->
      <div class="header_bluepart">
        <div class="container">
          <div class="row">
            <div class="col-md-6 col-sm-6">
             
            </div>
            <div class="col-md-6 col-sm-6 text-right">
              <div class="top_right_nav group_right_nav">
                <ul>
                   <li>
                    <div class="dropdown"> <a href=""  type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" id="dLabel2"></a>
                      <ul class="dropdown-menu" aria-labelledby="dLabel" id="drpmenu1">
                       </ul>
                    </div>
                  </li>
                   @if (Request.IsAuthenticated && session.UserSession != null)
                {
                  <li>
                    <div class="dropdown">
                    <a  id="uname"  href="@Url.Action("UserSetting", "Home")"><span class="glyphicon glyphicon-cog"></span></a>
                   @*<ul class="dropdown-menu" aria-labelledby="dLabel">
                      ...
                    </ul>*@
                  </li>
                  <li><a href="@Url.Action("LogOut", "Account")">Sign Out</a></li>
                }  
                </ul>
              </div>
            </div>
          </div>
        </div>
        <div class="clearfix"></div>
      </div>
      <!-- header_bluepart end -->
      <!-- inner navigation start -->
      	<div class="inner_nav">
        <div class="container">
        	<div class="row">
            <div class="col-md-12">
        	 <div class="navbar-header">
          <button data-target="#bs-example-inner-navbar-collapse-1" data-toggle="collapse" class="navbar-toggle collapsed" type="button"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button>
         </div>
       
        <div id="bs-example-inner-navbar-collapse-1" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="active"> <a href="@Url.Action("AdminSetting", "Home")" class="page-scroll">Users</a> </li>
            @*<li> <a href="" class="page-scroll">Roles</a> </li>*@
            <li> <a href="@Url.Action("Location", "Home")" class="page-scroll">Locations</a> </li>
            <li> <a href="@Url.Action("Group", "Home")" class="page-scroll">Groups</a> </li>
            @*<li> <a href="" class="page-scroll">Gateways</a> </li>
    <li> <a href="" class="page-scroll">Destinations</a> </li>
    <li> <a href="" class="page-scroll">Routing Rules</a> </li>
    <li> <a href="" class="page-scroll">Purge  Rules</a> </li>
     <li> <a href="" class="page-scroll">Study Sharing</a> </li>*@
              <li> <a href="@Url.Action("OrgSetting", "Home")" class="page-scroll">Settings</a> </li>
              @*<li> <a href="" class="page-scroll">Custom Fields</a> </li>*@
          </ul>
          </div>
          </div>
        </div>
        </div>
        </div>
       <!-- inner navigation end -->
    </nav>
    <div class="clearfix"></div>
  </header>
  <!--Header sec end--> 

    @RenderBody()

<!-- jQuery (necessary for Bootstrap's JavaScript plugins) --> 
<script src="@Url.Content("~/Content/js/jquery.min.js")"></script> 
<!-- Include all compiled plugins (below), or include individual files as needed --> 
<script src="@Url.Content("~/Content/js/bootstrap.min.js")"></script>
</body>
</html>

<script type="text/javascript">


    $(document).ready(function () {

        GetUserInfo();
        getOrg();
        getUserList();
       
    });

    

    
    function GetUserInfo() {

        var sid = '@session.UserSession.sid';
        //var studyuid = $('#stdid' + count).val();
        //var uuid = '@session.UserSession.uuid';
        //alert("Hello Pdata" + sid );

        $.ajax({
            url: 'https://access.dicomgrid.com/api/v3/user/get',
            dataType: "json",
            type: "POST",
            data: { "sid": sid },
            //async: false,
            //cache: false,
            success: function (data) {
                $('#uname').html(data.name + "<span class=\"glyphicon glyphicon-cog\"></span>");
                $('#settinguname').html(data.name);
                $('#exampleInputEmail1').val(data.email);
                $('#firstName').val(data.first);
                $('#lastName').val(data.last);

            },
            error: function (xhr) {
                var _html = "";
                $.each(xhr, function (i, value) {
                    //_html += i + "-" + value + "<br>";
                    // $('#newtr').html(value);

                });
                // $('#tblEditSession').html(_html);
            }
        });


    }

    function getOrg() {


        var sid = '@session.UserSession.sid';
        //var studyuid = $('#stdid' + count).val();
        //var uuid = '@session.UserSession.uuid';
      //alert("Hello Pdata" + sid );

      $.ajax({
          url: 'https://access.dicomgrid.com/api/v3/account/list',
          dataType: "json",
          type: "POST",
          data: { "sid": sid, "permissions": "1" },
          //async: false,
          //cache: false,
          success: function (data) {
              var _html = "";
              var _html1 = "";
              var j = 0;
              var orgid = "";
              for (var i = 0; data.accounts.length; i++) {

                  if (data.accounts[i].permissions.account_edit == "1") {
                      orgid = data.accounts[i].uuid;
                      $('#txtorgid').val(data.accounts[i].uuid);
                      //$('#dLabel1').html(data.namespaces[0].name + " <span class='caret'></span>");
                      $('#dLabel2').html(data.accounts[i].name + " <span class='glyphicon glyphicon-triangle-bottom drop_icon'></span>");
                      //if(data.namespaces[i].type == "user_id")
                      //_html += "<li><input type='hidden' id='uuid" + i + "' value='" + data.namespaces[i].uuid + "'/> <a id='tp" + i + "' href='#' onclick='changeFilter(" + i + ");'>" + data.namespaces[i].name + "</a></li>";
                      // else
                     // alert(orgid);

                      $.ajax({
                          url: 'https://access.dicomgrid.com/api/v3/account/user/list',
                          dataType: "json",
                          type: "POST",
                          data: { "sid": sid, "uuid": orgid },
                          //async: false,
                          //cache: false,
                          success: function (data) {
                              var _html = "";
                              for (var i = 0; i <= data.users.length; i++) {
                                  if (data.users[i].user_email.indexOf('dicomgrid.com') > -1)
                                  { }
                                  else {
                                      //alert('Hello');
                                      _html += "<tr><td><h4>" + data.users[i].user_name + "<i class='fa fa-file-text-o'></i></h4></td><td></td><td><a href='#'>" + data.users[i].user_email + "</a></td>";
                                      _html += "<td></td><td></td><td>" + data.users[i].role_name + "</td><td><div class='edit_list user_list'><ul><li><a href='#'> <i class='fa fa-pencil' aria-hidden='true'></i></a></li>";
                                      _html += "<li><a href='#'> <i class='fa fa-trash' aria-hidden='true'></i> </a></li></ul></td></tr>";
                                      $('#userlist1').html(_html);
                                  }
                              }



                          },
                          error: function (xhr) {
                              var _html = "";
                              $.each(xhr, function (i, value) {
                                  //_html += i + "-" + value + "<br>";
                                  // $('#newtr').html(value);

                              });
                              // $('#tblEditSession').html(_html);
                          }
                      });


                      $.ajax({
                          url: 'https://access.dicomgrid.com/api/v3/location/list',
                          dataType: "json",
                          type: "POST",
                          data: { "sid": sid, "account_id": orgid },
                          //async: false,
                          //cache: false,
                          success: function (data) {
                              var _html = "";
                              if (data.locations.length > 0) {
                                  for (var i = 0; i <= data.locations.length; i++) {
                                      //alert('Hello');
                                      _html += "<tr><td><h4>" + data.locations[i].name + "</h4></td><td><h4>" + data.locations[i].share_code + "</h4></td><td><a href='#'>" + data.locations[i].share_description + "</a><div class='edit_list'>";
                                      _html += "<ul><li><a href='#'><i class='fa fa-user' aria-hidden='true'></i></a></li><li class='edit_link'><div class='dropdown'><a href='#' id='dLabel' data-toggle='dropdown' aria-haspopup='true' aria-expanded='false' onclick='deletelocation("+i+");'> <i class='fa fa-pencil' aria-hidden='true'></i></a>";
                                      _html += "<ul class='dropdown-menu edit_dropdown' aria-labelledby='dLabel'><input type='hidden' id='locationid"+i+"' value='" + data.locations[i].uuid + "'/><form><div class='form-group'><label>Name</label><input type='text' class='form-control'>";
                                      _html += "</div><div class='form-group'><label>Share Code</label><input type='text' class='form-control'></div><div class='form-group'><label>Share Description</label>";
                                      _html += "<input type='text' class='form-control'></div><div class='form-group'><label>Anonymize Fields</label><select class='form-control'><option>Select</option>";
                                      _html += "<option>1</option></select><input type='text' class='form-control anon_feild'><span><a href='#'><i class='fa fa-times' aria-hidden='true'></i></a></span></div>";
                                      _html += "<div class='clearfix'></div><div class='form-group'><label>Anonymize Fields</label><select class='form-control'><option>Select</option><option>1</option></select>";
                                      _html += "<input type='text' class='form-control anon_feild'><span><a href='#'><i class='fa fa-times' aria-hidden='true'></i></a></span></div><div class='clearfix'></div>";
                                      _html += "<div class='form-group'><div class='checkbox'><label><input type='checkbox'> Studies shared with this location must go through the approval process</label>";
                                      _html += "</div><div class='checkbox'><label><input type='checkbox'> Studies uploaded to this location must go through the approva process</label></div><div class='checkbox'>";
                                      _html += "<label><input type='checkbox'> Studies can only be shared with users in the location, not the location</label></div><div class='checkbox'><label><input type='checkbox'> Enable upload notification for users added to this location </label></div>";
                                      _html += "<div class='form-group'><button type='submit' class='btn btn-default search'>Save</button><button type='submit' class='btn btn-default'>Cancel</button></div></div></form></ul></div>";
                                      _html += "</li><li><a href='#'><i class='fa fa-trash' aria-hidden='true'></i></a></li></ul></div></td></tr>";

                                      $('#locationlist1').html(_html);
                                  }
                              } else {
                                  $('#locationlist1').html("No Location Found");
                              }

                          },
                          error: function (xhr) {
                              var _html = "";
                              $.each(xhr, function (i, value) {
                                  //_html += i + "-" + value + "<br>";
                                  // $('#newtr').html(value);
                                  $('#locationlist1').html("No Study Found");
                              });
                              // $('#tblEditSession').html(_html);
                          }
                      });



                      $.ajax({
                          url: 'https://access.dicomgrid.com/api/v3/group/list',
                          dataType: "json",
                          type: "POST",
                          data: { "sid": sid, "account_id": orgid },
                          //async: false,
                          //cache: false,
                          success: function (data) {
                              var _html = "";
                              if (data.groups.length > 0) {
                                  for (var i = 0; i <= data.groups.length; i++) {
                                      //alert('Hello');
                                      _html += "<tr><td><h4>" + data.groups[i].name + "</h4></td><td><h4>" + data.groups[i].share_code + "</h4></td><td><a href='#'>" + data.groups[i].share_description + "</a><div class='edit_list'>";
                                      _html += "<ul><li><a href='#'><i class='fa fa-user' aria-hidden='true'></i></a></li><li><a href='#'><i class='fa fa-pencil' aria-hidden='true'></i></a></li>";
                                      _html += "<li><a href='#'><i class='fa fa-trash' aria-hidden='true'></i></a></li></ul></div></td></tr>";

                                      $('#grouplist1').html(_html);
                                  }
                              } else {
                                  $('#grouplist1').html("No Group Found");
                              }

                          },
                          error: function (xhr) {
                              var _html = "";
                              $.each(xhr, function (i, value) {
                                  //_html += i + "-" + value + "<br>";
                                  // $('#newtr').html(value);
                                  $('#locationlist1').html("No Group Found");
                              });
                              // $('#tblEditSession').html(_html);
                          }
                      });



                      $.ajax({
                          url: 'https://access.dicomgrid.com/api/v3/role/list',
                          dataType: "json",
                          type: "POST",
                          data: { "sid": sid, "account_id": orgid },
                          //async: false,
                          //cache: false,
                          success: function (data) {
                              var _html = "<option value=''>Select Role</option>";
                             
                                  for (var i = 0; i <= data.roles.length; i++) {

                                      _html += "<option value='" + data.roles[i].uuid + "'>" + data.roles[i].name + "</option>";

                                      $('#accountroles1').html(_html);
                                      $('#accountroles2').html(_html);
                                      $('#accountroles3').html(_html);
                                  }
                              

                          },
                          error: function (xhr) {
                            
                              $.each(xhr, function (i, value) {
                                 
                                 
                              });
                            
                          }
                      });

                  }
                  _html1 += "<li><input type='hidden' id='acceditstatus" + i + "' value='" + data.accounts[i].permissions.account_edit + "' /> <input type='hidden' id='uuid1" + i + "' value='" + data.accounts[i].uuid + "'/><a id='tp1" + i + "' href='#' onclick='changeFilter1(" + i + ");'>" + data.accounts[i].name + "</a></li>";
                  //$('#drpmenu').html(_html);
                  $('#drpmenu1').html(_html1);
                  // $('#orglist').html(_html);
              }




          },
          error: function (xhr) {
              var _html = "";
              $.each(xhr, function (i, value) {
                  //_html += i + "-" + value + "<br>";
                  // $('#newtr').html(value);

              });
              // $('#tblEditSession').html(_html);
          }
      });


    }

    function addNewUser()
    {

        var sid = '@session.UserSession.sid';
        var account_id = $('#txtorgid').val();
        var first = $('#txtfname').val();
        var last = $('#txtlname').val();
        var password = $('#txtuserpassword');
        var cpassword = $('#txtusercpassword');
        var email = $('#txtuseremail').val();
        var accountrole1 = $('#accountroles1').find('option:selected').val();
        var orgemail = $('#txtorgmail').val();
        var orglogin = $('#txtorglogin').val();
        var orgalias = $('#txtorgalias').val();
        if (password != cpassword) {

            alert("Both Password are not same Please Enter Same Password in Both Fields");

        }
        else
        {

        $.ajax({
            url: 'https://access.dicomgrid.com/api/v3/user/add',
            dataType: "json",
            type: "POST",
            data: { "sid": sid, "account_id": account_id, "first": first, "last": last, "password": password, "email": email },
            //async: false,
            //cache: false,
            success: function (data) {
              
                if (data.status == "OK") {

                    var useruuid = data.uuid;
                    var namespace_id = data.namespace_id;

                    $.ajax({
                        url: 'https://access.dicomgrid.com/api/v3/account/user/add',
                        dataType: "json",
                        type: "POST",
                        data: { "sid": sid, "uuid": account_id, "user_id": useruuid, "role_id": accountrole1, "account_email": orgemail, "account_alias": orgalias, "account_login": orglogin, "account_password": password },
                        //async: false,
                        //cache: false,
                        success: function (data) {

                            if (data.status == "OK") {

                                alert("User Added Successfully");




                            }


                        },
                        error: function (xhr) {

                            $.each(xhr, function (i, value) {


                            });

                        }
                    });              


                }


            },
            error: function (xhr) {

                $.each(xhr, function (i, value) {


                });

            }
        });

        }
        
    }

 </script>